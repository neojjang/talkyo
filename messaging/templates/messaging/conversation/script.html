{% load static %}

<script src="{% static 'channels/js/websocketbridge.js' %}"></script>
<script>

  const webSocketBridge = new channels.WebSocketBridge();
  webSocketBridge.connect('/conversation/{{ conversation.id }}/');

  webSocketBridge.listen(function(action, stream) {
    var messages = document.getElementById("messages");
    messages.innerHTML += "<b>" + action["author"] + ":</b> " +  action["text"] + "<br>";
    messages.scrollTop = messages.scrollHeight;
  });

  document.getElementById("message").addEventListener("submit", function() {
    var text = document.getElementById("text").value
    webSocketBridge.send({text: text});
  });

  window.addEventListener("load", function(){
    var messages = document.getElementById("messages");
    messages.scrollTop = messages.scrollHeight;
    document.getElementById("text").focus();
  });

</script>
